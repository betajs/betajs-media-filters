/*!
betajs-media - v0.0.44 - 2017-02-22
Copyright (c) Ziggeo,Oliver Friedmann
Apache-2.0 Software License.
*/
(function(){var a=this.subScope();a.binding("module","global:BetaJS.MediaFilter"),a.binding("media","global:BetaJS.Media"),a.binding("base","global:BetaJS"),a.binding("browser","global:BetaJS.Browser"),a.binding("flash","global:BetaJS.Flash"),a.binding("jquery","global:jQuery"),a.define("module:",function(){return{guid:"8475efdb-dd7e-402e-9f50-36c76945a692",version:"0.0.44"}}),a.assumeVersion("base:version","~1.0.96"),a.assumeVersion("browser:version","~1.0.61"),a.assumeVersion("media:version","undefined"),a.define("module:FilterSupport",[],function(){return{filterTask:function(a,b,c){var d,e,f,g=a._video,h=g.parentNode,i=g.clientHeight,j=g.clientWidth,k="ba-video-"+a._stream.id,l=!1;b||(b=document.createElement("canvas")),b.height=i,b.width=j,h.appendChild(b),b.className=k,g.style.display="none";const m=function n(){f||(f=b.getContext("2d")),d||(d=document.createElement("canvas"),e=d.getContext("2d"),d.width=b.width,d.height=b.height),e.drawImage(g,0,0,d.width,d.height);const a=e.getImageData(0,0,d.width,d.height),h=c(a);f.putImageData(h,0,0),l?(d=null,e=null,f=null):requestAnimationFrame(n)};return requestAnimationFrame(m),{stop:function(){l=!0}}},filterCanvasControl:function(a,b){var c=b||25,d=".ba-video-"+a.id,e=document.querySelector(d);return e&&(a=e.captureStream(c),e.className="ba-video-"+a.id),a}}}),a.define("module:MediaFilters",["module:FilterSupport"],function(a){return{invert:function(b,c){const d=function(a){const b=new Uint8ClampedArray(a.data.length);for(var c=0;c<a.data.length;c+=4)b[c]=255-a.data[c],b[c+1]=255-a.data[c+1],b[c+2]=255-a.data[c+2],b[c+3]=a.data[c+3];const d=new ImageData(b,a.width,a.height);return d};return a.filterTask(b,c,d)},colourShift:function(a,b,c,d,e){const f=new Uint8ClampedArray(e.data.length);for(var g=0;g<e.data.length;g+=4)f[g]=Math.min(255,e.data[g]+a),f[g+1]=Math.max(0,Math.min(255,e.data[g+1]+b)),f[g+2]=Math.max(0,Math.min(255,e.data[g+2]+c)),f[g+3]=Math.max(0,Math.min(255,e.data[g+3]+d));const h=new ImageData(f,e.width,e.height);return h},colourFilter:function(b,c,d,e,f,g){return a.filterTask(f,g,colourShift.bind(this,b,c,d,e))}}}),a.define("module:CanvasRecorder",["media:WebRTC.WhammyRecorder","media:WebRTC.Support","module:FilterSupport"],function(a,b,c,d){return a.extend({scoped:d},function(a){return{constructor:function(b,c){a.constructor.call(this)},start:function(){this._started||(this._started=!0,this._options.video&&(this._options.recordWidth=this._options.video.videoWidth||this._options.video.clientWidth,this._options.recordHeight=this._options.video.videoHeight||this._options.video.clientHeight),this._video=document.createElement("video"),this._video.width=this._options.recordWidth,this._video.height=this._options.recordHeight,this._stream=c.filterCanvasControl(this._stream,25),b.bindStreamToVideo(this._stream,this._video),this._frames=[],this._lastTime=Time.now(),this._startTime=this._lastTime,this.trigger("started"),Async.eventually(this._process,[],this))}}},{supported:function(){return b.globals().webpSupport}})}),a.define("module:RecorderFilter",["media:WebRTC.RecorderWrapper","module:MediaFilters"],function(a,b,c){return a.extend({scoped:c},[function(a){return{applyFilter:function(a){b[a](this)},destroyFilter:function(){var a=document.querySelector(".ba-video-"+this._stream.id);a&&(a.remove(),this._video.style.display="block")}}}],{supported:function(a){return!!Support.globals().getUserMedia&&!!Support.globals().URL}})})}).call(Scoped);